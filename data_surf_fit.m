% clear all;
load fit;
%dane z Compressibility and Intermolecular Forces in Gases. II. Nitrous Oxide 
% H. W. Schamp, E. A. Mason, and K. Su 
% N=10;
% mod=linspace(1,11,N)*0.1;
% mod2=linspace(1,11,N)*0.1;
% mod22=linspace(1,11,N)*10e12;
mod=[];
mod2=[];
mod22=[];

pe{1}=[mod, 16.0068, 19.4042, 22.4035, 25.0506, 27.6491, 29.8699];
ro{1}=[mod, 18.2206, 22.9183, 27.4364, 31.7965, 36.5034, 40.9777];
tr{1}=ones(1,length(pe{1}))*0;

pe{2}=[mod, 17.9225, 21.8920, 25.4731, 28.7116, 31.9766, 34.8671, 37.6875, 40.4381];
ro{2}=[mod, 18.2206, 22.9183, 27.4364, 31.7965, 36.5034, 40.9777, 45.6862, 50.6699];
tr{2}=ones(1,length(pe{2}))*25;

pe{3}=[mod, 18.7853, 19.8025, 23.1019, 24.3184, 27.0616, 28.4499, 30.7074, 32.2404, 34.4582, 34.9074, 36.1267, 37.8479, 39.6308, 41.1351, 41.2391, 43.1205, 43.4766, 44.6387, 46.6062, 47.803, 50.336, 54.896, 57.559, 62.456, 65.121, 70.189, 72.7040, 76.820, 79.0040, 82.2020, 84.074, 86.3330, 87.9350];
ro{3}=[mod, 17.1960, 18.2206, 21.6294, 22.9183, 25.8933, 27.4364, 30.0082, 31.7965, 34.4503, 34.9987, 36.5034, 38.6728, 40.9777, 42.9748, 43.1164, 45.6862, 46.1828, 47.8197, 50.6699, 52.452, 56.368, 63.937, 68.710, 78.414, 84.269, 96.957, 104.201, 118.08, 126.903, 141.941, 152.55, 167.874, 180.426];
tr{3}=ones(1,length(pe{3}))*50;

pe{4}=[mod, 20.5239, 21.6552, 25.3369, 26.7039, 29.7949, 31.3703, 33.9369, 35.6884, 38.2402, 38.7616, 40.1720, 42.1750, 44.2604, 46.0346, 46.1540, 48.3849, 50.1963, 52.5594, 54.017, 62.806, 72.653, 83.522, 93.967, 103.904, 113.222];
ro{4}=[mod, 17.1960, 18.2206, 21.6294, 22.9183, 25.8933, 27.4364, 30.0082, 31.7965, 34.4503, 34.9987, 36.5034, 38.6728, 40.9777, 42.9748, 43.1164, 45.6862, 47.8197, 50.6699, 52.452, 63.937, 78.414, 96.957, 118.08, 141.941, 167.874];
tr{4}=ones(1,length(pe{4}))*75;

pe{5}=[mod, 22.2497, 27.5515, 32.4919, 37.1168, 41.9584, 46.4193, 50.9713, 54.0311, 55.6354, 63.7290, 74.613, 87.093, 101.451, 116.039, 131.009, 146.408];
ro{5}=[mod, 17.1960, 21.6294, 25.8933, 30.0082, 34.4503, 38.6728, 43.1164, 46.1828, 47.8197, 56.3680, 68.710, 84.269, 104.201, 126.903, 152.550, 180.426];
tr{5}=ones(1,length(pe{5}))*100;

pe{6}=[mod, 23.9643, 29.7478, 35.1675, 40.2674, 45.6377, 46.2899, 50.6173, 55.5658, 55.7258, 60.9964, 66.0568, 78.065, 92.237, 109.051, 126.801, 145.651, 165.482];
ro{6}=[mod, 17.1960, 21.6294, 25.8933, 30.0082, 34.4503, 34.9987, 38.6728, 42.9748, 43.1164, 47.8197, 52.4520, 63.937, 78.414,  96.957, 118.080, 141.941, 167.874];
tr{6}=ones(1,length(pe{6}))*125;

pe{7}=[mod, 25.6717, 31.9336, 37.8278, 43.3961, 49.2870, 54.7738, 60.4324, 66.3020];
ro{7}=[mod, 17.1960, 21.6294, 25.8933, 30.0082, 34.4503, 38.6728, 43.1164, 47.8197];
tr{7}=ones(1,length(pe{7}))*150;

p1=[];
r1=[];
t1=[];

K=273.15; %[K]
P0=101325;%[Pa]
%N2O molar mass
Mm=44.013;          %[g/mol][z wiki]
%N2O STP amg
rSTP=4.4940*10^(-5);  %[mol/cc][z tekstu]
for i=1:length(pe)
   
    p1=[p1,pe{i}];
    r1=[r1,ro{i}];
    t1=[t1,tr{i}];
    [size(pe{i}), size(ro{i}), size(tr{i})]
end
AMG=r1;

r1=rSTP * AMG;        %[mol/cc] AMG to ro z pomiarow z tekstu
r1=r1*Mm;             %[g/cc]
r1=r1*(10^6/10^3);    %[kg/m^3]

p1=p1*P0;             %[Pa] P[atm->Pa(x 101 325)]
t1=t1+K;              %T[C->K]

TRoP1=[t1', r1', p1'];

% sf1 = fit([TRoP1(:,3), TRoP1(:,2)],TRoP1(:,1),'poly23');
% figure(2);
% plot(sf1,[TRoP1(:,3),TRoP1(:,2)],TRoP1(:,1));
% xlabel('Pressure [Pa]'); ylabel('Density [kg/m^3]'); zlabel('Temperature [K]');



%dane z Volumetric Behavior of Nitrous Oxide Pressure-Volume Isotherms at High Pressures 
% Gas Compressibility Factors at Low Pressures EARL J. COUCH' and KENNETH A. KOBE2
p{1}=[mod2, 6,7,8,9,10,11,12];
r{1}=[mod22, 70.533, 59.686, 51.540, 45.179, 40.058, 35.848, 32.301];
t{1}=ones(1,length(r{1}))*(-30);

p{2}=[mod2, 6,8,10,12,14,15,16,18,20];
r{2}=[mod22, 75.903, 55.796, 43.674, 35.557, 29.725, 27.377, 25.317, 21.876, 19.019];
t{2}=ones(1,length(r{2}))*(-15);

p{3}=[mod2, 6,8,10,12,15,20,25,28,29,30];
r{3}=[mod22, 81.102, 59.840, 47.062, 38.510, 29.922, 21.268, 15.959, 13.633, 12.934, 12.266];
t{3}=ones(1,length(r{3}))*0.001;

p{4}=[mod2, 6,8,10,12,15,20,25,30,35,40,42,44];
r{4}=[mod22, 86.201, 63.811, 50.351, 41.350, 32.331, 23.266, 17.774, 14.035, 11.281, 9.131, 8.362, 7.628];
t{4}=ones(1,length(r{4}))*15;

p{5}=[mod2, 6,8,10,12,15,20,25,30,36,40,45,50,55,58,60,62];
r{5}=[mod22, 91.243, 67.691, 53.537, 44.096, 34.629, 25.132, 19.403, 15.532, 12.738, 10.614, 8.895, 7.467, 6.204, 5.470, 4.964, 4.391];
t{5}=ones(1,length(r{5}))*30;

p{6}=[mod2, 25,30,35,40,45,50,55,60,65,68,70,71,72,74,76,78,80,90,100,120,140,160,180,200,220,240,260,280,300,315];
r{6}=[mod22, 20.074, 16.144, 13.313, 11.158, 9.450, 8.045, 6.843, 5.776, 4.752, 4.098, 3.555, 3.173, 1.792, 1.636, 1.567, 1.527, 1.498, 1.409, 1.3547, 1.2913, 1.2490, 1.2160, 1.1906, 1.16895, 1.1512, 1.1354, 1.1215, 1.1086, 1.0967, 1.0886];
t{6}=ones(1,length(r{6}))*36.45;

p{7}=[mod2, 68,70,72,74,76,78,80,85,90];
r{7}=[mod22, 4.61, 4.234, 3.838, 3.377, 2.758, 1.955, 1.737, 1.576, 1.506];
t{7}=ones(1,length(r{7}))*40;

p{8}=[mod2, 68,70,72,74,76,78,80,82,85,90,95,100,105,110];
r{8}=[mod22, 5.039, 4.175, 4.386, 4.059, 3.722, 3.36, 2.969, 2.526, 2, 1.705, 1.592, 1.526, 1.479, 1.443];
t{8}=ones(1,length(r{8}))*44;

p{9}=[mod2, 8,10,15,20,30,40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,220,240,260,280,300,315];
r{9}=[mod22, 72.797, 57.719, 37.580, 27.498, 17.344, 12.208, 9.07, 6.905, 5.254, 3.862, 2.559, 1.824, 1.613, 1.513, 1.449, 1.404, 1.368, 1.339, 1.315, 1.293, 1.274, 1.258, 1.230, 1.207, 1.188, 1.170, 1.154, 1.145];
t{9}=ones(1,length(r{9}))*50;

p{10}=[mod2, 8,10,15,20,30,40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,220,240,260,280,300,315];
r{10}=[mod22, 79.053, 62.808, 41.140, 30.287, 19.408, 13.945, 10.644, 8.421, 6.815, 5.592, 4.622, 3.835, 3.197, 2.692, 2.320, 2.064, 1.886, 1.763, 1.674, 1.607, 1.552, 1.508, 1.440, 1.388, 1.349, 1.317, 1.287, 1.266];
t{10}=ones(1,length(r{10}))*75;

p{11}=[mod2, 8,10,15,20,30,40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,220,240,260,280,300,315];
r{11}=[mod22, 85.225, 67.818, 44.609, 32.998, 21.352, 15.522, 12.012, 9.668, 7.990, 6.728, 5.745, 4.961, 4.321, 3.793, 3.359, 3.002, 2.709, 2.472, 2.281, 2.129, 2.008, 1.908, 1.757, 1.652, 1.573, 1.510, 1.462, 1.42];
t{11}=ones(1,length(r{11}))*100;

p{12}=[mod2, 8,10,15,20,30,40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,220,240,260,280,300,315];
r{12}=[mod22, 91.343, 72.785, 48.018, 35.617, 23.215, 17.001, 13.273, 10.789, 9.017, 7.688, 6.656, 5.833, 5.163, 4.611, 4.149, 3.760, 3.430, 3.152, 2.914, 2.714, 2.543, 2.396, 2.164, 1.992, 1.862, 1.761, 1.681, 1.632];
t{12}=ones(1,length(r{12}))*125;

p{13}=[mod2, 8,10,15,20,30,40,50,60,70,80,90,100,110,120,130,140,150,160,170,180,190,200,220,240,260,280,300,315];
r{13}=[mod22, 97.423, 77.694, 51.381, 38.196, 25.020, 18.424, 14.468, 11.834, 9.955, 8.551, 7.460, 6.591, 5.883, 5.297, 4.805, 4.390, 4.033, 3.729, 3.465, 3.235, 3.035, 2.861, 2.576, 2.353, 2.178, 2.038, 1.928, 1.860];
t{13}=ones(1,length(r{13}))*150;

p2=[];
r2=[];
t2=[];

K=273.15; %[K]
P0=101325;%[Pa]
for i=1:length(p)
    
    p2=[p2,p{i}];
    r2=[r2,r{i}];
    t2=[t2,t{i}];
%     [size(p{i}), size(r{i})]
end

p2=p2*P0;                %P[atm->Pa(x 101 325)]
r2=(1./r2)*(10^6/10^3);  %R[ml/g->kg/m3]
t2=t2+K;                 %T[C->K]
TRoP2=[t2',r2',p2'];    


% %porownanie zestawow danych
% scatter3(TRoP1(:,3),TRoP1(:,2),TRoP1(:,1));hold on;
% scatter3(TRoP2(:,3),TRoP2(:,2),TRoP2(:,1),'filled');
% line(TRoP1(:,3),TRoP1(:,2),TRoP1(:,1))
% xlabel('Pressure [Pa]'); ylabel('Density [kg/m^3]'); zlabel('Temperature [K]');


p3=[p1,p2];
r3=[r1,r2];
t3=[t1,t2];
TRoP3=[t3',r3',p3'];


% 
% sf2 = fit([TRoP3(:,3), TRoP3(:,2)],TRoP3(:,1),'poly23');
% figure(3);
% plot(sf2,[TRoP3(:,3),TRoP3(:,2)],TRoP3(:,1)); zlim([min(TRoP3(:,1)) max(TRoP3(:,1))]);
% xlabel('Pressure [Pa]'); ylabel('Density [kg/m^3]'); zlabel('Temperature [K]')

% % % sf3 = fit([TRoP3(:,3), TRoP3(:,2)],TRoP3(:,1),'lowess','Robust','Bisquare');
% % figure(4);
% % plot(sf3,[TRoP3(:,3),TRoP3(:,2)],TRoP3(:,1));
% % xlabel('Pressure [Pa]'); ylabel('Density [kg/m^3]'); zlabel('Temperature [K]');

% error=sf2(TRoP3(:,3), TRoP3(:,2)) - TRoP3(:,1);
% sf4 = fit([TRoP3(:,3), TRoP3(:,2)],error,'poly23');
% figure(5);
% plot(sf4,[TRoP3(:,3),TRoP3(:,2)],error); zlim([min(error) max(error)]);
% xlabel('Pressure [Pa]'); ylabel('Density [kg/m^3]'); zlabel('error Temperature [K]');

figure(6);
plot(poly23_LAR,[TRoP3(:,3),TRoP3(:,2)],TRoP3(:,1)); zlim([min(TRoP3(:,1)) max(TRoP3(:,1))]);
title('poly23 LAR model');
xlabel('Pressure [Pa]'); ylabel('Density [kg/m^3]'); zlabel('Temperature [K]');

% sf4 = fit([TRoP3(:,3), TRoP3(:,2)],error,'poly23');
figure(7);
error=poly23_LAR([TRoP3(:,3),TRoP3(:,2)]) - TRoP3(:,1);
plot(poly23_LAR,[TRoP3(:,3),TRoP3(:,2)],error); zlim([min(error) max(error)]);
title('poly23 LAR model error');
xlabel('Pressure [Pa]'); ylabel('Density [kg/m^3]'); zlabel('error Temperature [K]');

% %        cor=poly23_LAR;
% %        cor.p00=poly23_LAR.p00 -sf4.p00;      
% %        cor.p10=poly23_LAR.p10 -sf4.p10; 
% %        cor.p20=poly23_LAR.p20 -sf4.p20;
% %        cor.p02=poly23_LAR.p02 -sf4.p02;
% %        cor.p21=poly23_LAR.p21 -sf4.p21; 
% %        cor.p12=poly23_LAR.p12 -sf4.p12;
% %        cor.p03=poly23_LAR.p03 -sf4.p03;
% % ecor=cor([TRoP3(:,3),TRoP3(:,2)]) - TRoP3(:,1);
% % plot(cor,[TRoP3(:,3),TRoP3(:,2)],ecor); %zlim([min(error) max(error)]);

% figure(99);
% err=spline_fit(TRoP3(:,3), TRoP3(:,2)) - TRoP3(:,1);
% % plot(spline_fit,[TRoP3(:,3),TRoP3(:,2)],TRoP3(:,1));
% scatter3(TRoP3(:,3),TRoP3(:,2),err,'filled')
% xlabel('Pressure [Pa]'); ylabel('Density [kg/m^3]'); zlabel('error Temperature [K]');



